<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="theme-color" content="#0B0E17"/>
<title>Spell It! â€” Richter Fun</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
html,body,#root{height:100%;font-family:'Fredoka',sans-serif}
body{background:#0B0E17;overflow-x:hidden}
@keyframes su{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes bn{0%,100%{transform:scale(1)}40%{transform:scale(1.15)}70%{transform:scale(0.95)}}
@keyframes pu{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
@keyframes fadeWord{0%{opacity:1;transform:scale(1)}70%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.95)}}
@keyframes glowPulse{0%,100%{text-shadow:0 0 10px rgba(255,215,0,0.3)}50%{text-shadow:0 0 25px rgba(255,215,0,0.6)}}
@keyframes cb{0%{opacity:1;transform:translate(0,0) scale(0) rotate(0)}40%{opacity:1}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(1.3) rotate(720deg)}}
input::placeholder{color:rgba(255,255,255,0.25)}
input:focus{outline:none}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useCallback}=React;

const SK="spell_app_v4";
const sto={
  get:k=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):null}catch{return null}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}
};

const FIRE=["LEGEND! ğŸ”¥","Benny Friedman approved! ğŸ¤","GESHMAK! âœ¨","Mamash amazing! ğŸ’","Chanukah menorah energy! ğŸ•","Ishay Ribo level! ğŸ¶","GADOL move! ğŸ†","Shabbos cholent vibes! ğŸ²","Mordechai Shapiro says WOW! ğŸµ","BOSS! ğŸ‘‘","Fresh challah smooth! ğŸ","MaccaBeats remix! ğŸ§","PRO! ğŸ’ª","Zusha energy! ğŸŒŸ","Built like a sukkah! ğŸ—ï¸","Shepping nachas! â¤ï¸","Tzaddik move! âœ¡ï¸"];
const MISS=["Almost! Next one's yours ğŸ’ª","So close! Even Moshe needed tries ğŸŒŸ","Not yet â€” getting stronger âš¡","That's how we learn ğŸ“–","Winners keep going ğŸ†","Close! Get the next one ğŸ¯","Maccabees lost rounds too â­"];

const WORD_DB={
  double_trouble:{name:"Double Trouble",icon:"âœŒï¸",color:"#FF6B35",words:[
    {word:"accommodate",hint:"cc + mm",sentence:"The hotel can ___ 200 guests."},
    {word:"occurrence",hint:"cc + rr",sentence:"This is a rare ___."},
    {word:"committee",hint:"mm + tt + ee â€” triple!",sentence:"The ___ voted on new rules."},
    {word:"necessary",hint:"1 Collar(c), 2 Socks(s)",sentence:"Water is ___ for life."},
    {word:"occasion",hint:"cc but only 1 s",sentence:"A birthday is a special ___."},
    {word:"recommend",hint:"1 c, 2 m's",sentence:"I ___ this book."},
    {word:"tomorrow",hint:"1 m, 2 r's",sentence:"___ is another day."},
    {word:"disappear",hint:"1 s, 2 p's â€” poof!",sentence:"Watch it ___."},
    {word:"balloon",hint:"ll + oo â€” puffy!",sentence:"The red ___ floated away."},
    {word:"broccoli",hint:"cc but only 1 l",sentence:"Eat your ___."},
    {word:"embarrass",hint:"rr + ss",sentence:"Don't ___ me!"},
    {word:"misspell",hint:"ss â€” ironic!",sentence:"Don't ___ words."}
  ]},
  ninja_letters:{name:"Ninja Letters",icon:"ğŸ¥·",color:"#7C4DFF",words:[
    {word:"knowledge",hint:"silent K",sentence:"___ is power."},
    {word:"rhythm",hint:"no regular vowels!",sentence:"Keep a steady ___."},
    {word:"Wednesday",hint:"silent D â€” Wed-NES-day",sentence:"Pizza every ___."},
    {word:"knight",hint:"silent K + GH",sentence:"The ___ rode into battle."},
    {word:"wrinkle",hint:"silent W",sentence:"Iron out every ___."},
    {word:"scissors",hint:"silent C",sentence:"Cut with ___."},
    {word:"subtle",hint:"silent B",sentence:"A ___ difference."},
    {word:"psychology",hint:"silent P",sentence:"She studies ___."},
    {word:"gnaw",hint:"silent G",sentence:"Dogs ___ on bones."},
    {word:"column",hint:"silent N",sentence:"Read the first ___."},
    {word:"island",hint:"silent S",sentence:"A tropical ___."},
    {word:"listen",hint:"silent T",sentence:"___ carefully."}
  ]},
  ie_battle:{name:"I vs E Showdown",icon:"âš”ï¸",color:"#2979FF",words:[
    {word:"believe",hint:"I before E",sentence:"I ___ you can do it!"},
    {word:"receive",hint:"EI after C",sentence:"Did you ___ my message?"},
    {word:"achieve",hint:"I before E",sentence:"You can ___ your goals."},
    {word:"weird",hint:"EI â€” word IS weird",sentence:"That was really ___."},
    {word:"their",hint:"EI â€” exception!",sentence:"___ house is big."},
    {word:"ceiling",hint:"EI after C",sentence:"The ___ fan spins."},
    {word:"neither",hint:"EI â€” exception",sentence:"___ answer is right."},
    {word:"protein",hint:"EI",sentence:"Chicken has ___."},
    {word:"seize",hint:"EI",sentence:"___ the day!"},
    {word:"foreign",hint:"EI",sentence:"A ___ language."},
    {word:"science",hint:"IE after SC",sentence:"___ class is fun."},
    {word:"shield",hint:"IE",sentence:"Captain America's ___."}
  ]},
  endings:{name:"-TION vs -SION",icon:"ğŸ¯",color:"#E91E63",words:[
    {word:"education",hint:"-TION",sentence:"Getting an ___ matters."},
    {word:"permission",hint:"-SION (permitâ†’)",sentence:"Ask for ___ first."},
    {word:"competition",hint:"-TION",sentence:"The spelling ___."},
    {word:"television",hint:"-SION (has vision)",sentence:"Watched ___."},
    {word:"explanation",hint:"-TION",sentence:"Give me an ___."},
    {word:"decision",hint:"-SION (decideâ†’)",sentence:"A tough ___."},
    {word:"imagination",hint:"-TION",sentence:"Use your ___!"},
    {word:"expression",hint:"-SION",sentence:"A funny ___."},
    {word:"celebration",hint:"-TION",sentence:"Birthday ___!"},
    {word:"confusion",hint:"-SION (confuseâ†’)",sentence:"Lots of ___."},
    {word:"preparation",hint:"-TION",sentence:"___ is key."},
    {word:"explosion",hint:"-SION â€” BOOM!",sentence:"A loud ___."}
  ]},
  most_wanted:{name:"Most Wanted",icon:"ğŸ”¥",color:"#FF9800",words:[
    {word:"definitely",hint:"FINITE is inside!",sentence:"I'll ___ be there."},
    {word:"separate",hint:"A RAT is in there!",sentence:"___ the colors."},
    {word:"different",hint:"2 f's, 1 r",sentence:"Each person is ___."},
    {word:"beginning",hint:"double N",sentence:"Just the ___."},
    {word:"because",hint:"Big Elephants Can Always Understand Small Elephants",sentence:"I stayed home ___."},
    {word:"beautiful",hint:"beau-ti-ful",sentence:"A ___ sunset!"},
    {word:"calendar",hint:"-AR not -ER",sentence:"Mark the ___."},
    {word:"February",hint:"keep the first R!",sentence:"___ is short."},
    {word:"library",hint:"2 R's",sentence:"Books from the ___."},
    {word:"restaurant",hint:"AU in the middle",sentence:"Eat at the ___."},
    {word:"surprise",hint:"SUR not SER",sentence:"A ___!"},
    {word:"environment",hint:"N before M",sentence:"Protect the ___."},
    {word:"government",hint:"N before M",sentence:"The ___ passed a law."},
    {word:"temperature",hint:"temper-A-ture",sentence:"The ___ dropped."},
    {word:"immediately",hint:"double M",sentence:"Come ___!"},
    {word:"independent",hint:"-ENT not -ANT",sentence:"She is ___."}
  ]},
  able_ible:{name:"-ABLE or -IBLE?",icon:"ğŸ§©",color:"#00BCD4",words:[
    {word:"comfortable",hint:"-ABLE",sentence:"Very ___."},
    {word:"responsible",hint:"-IBLE",sentence:"Be ___."},
    {word:"available",hint:"-ABLE",sentence:"Is this ___?"},
    {word:"incredible",hint:"-IBLE",sentence:"That was ___!"},
    {word:"reasonable",hint:"-ABLE",sentence:"A ___ price."},
    {word:"terrible",hint:"-IBLE",sentence:"___ weather."},
    {word:"valuable",hint:"-ABLE",sentence:"Time is ___."},
    {word:"impossible",hint:"-IBLE",sentence:"Nothing is ___!"},
    {word:"favorable",hint:"-ABLE",sentence:"___ reviews."},
    {word:"flexible",hint:"-IBLE",sentence:"Be ___."},
    {word:"adorable",hint:"-ABLE",sentence:"An ___ puppy."},
    {word:"visible",hint:"-IBLE",sentence:"Stars are ___."}
  ]}
};

const todayStr=()=>new Date().toISOString().split("T")[0];
const rand=a=>a[Math.floor(Math.random()*a.length)];
const shuffle=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};
const speak=(t,r=0.8)=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);u.rate=r;u.lang="en-US";window.speechSynthesis.speak(u);}};
const allWords=()=>{const a=[];Object.entries(WORD_DB).forEach(([k,t])=>t.words.forEach((w,i)=>a.push({...w,id:k+"_"+i,track:k})));return a;};
const lev=(a,b)=>{const m=a.length,n=b.length,d=Array.from({length:m+1},()=>Array(n+1).fill(0));for(let i=0;i<=m;i++)d[i][0]=i;for(let j=0;j<=n;j++)d[0][j]=j;for(let i=1;i<=m;i++)for(let j=1;j<=n;j++)d[i][j]=a[i-1]===b[j-1]?d[i-1][j-1]:1+Math.min(d[i-1][j],d[i][j-1],d[i-1][j-1]);return d[m][n];};
const chk=(inp,cor)=>{const a=inp.trim().toLowerCase(),c=cor.toLowerCase();if(a===c)return"exact";if(lev(a,c)===1&&c.length>3)return"close";return"wrong";};
const mast=lv=>{if(lv===0)return{l:"New",c:"#78909C",e:"ğŸ†•"};if(lv<=2)return{l:"Learning",c:"#FF9800",e:"ğŸ“–"};if(lv<=4)return{l:"Getting It",c:"#2979FF",e:"ğŸ’ª"};if(lv<=6)return{l:"Almost Pro",c:"#AA00FF",e:"â­"};return{l:"MASTERED",c:"#00E676",e:"ğŸ†"};};
const FNT="'Fredoka',sans-serif";
const PG={minHeight:"100vh",background:"linear-gradient(160deg,#0B0E17 0%,#151A2E 50%,#0D1220 100%)",color:"#fff",fontFamily:FNT,overflow:"auto"};

function App(){
  const[data,setData]=useState(null);
  const[loaded,setLoaded]=useState(false);
  const[screen,setScreen]=useState("pick");
  const[user,setUser]=useState(null);
  const[cfg,setCfg]=useState({track:null,mode:"type"});

  const mk=()=>({asher:{p:{},cal:{d:{},s:0,b:0,last:null},xp:0,lv:1},rivka:{p:{},cal:{d:{},s:0,b:0,last:null},xp:0,lv:1}});
  useEffect(()=>{setData(sto.get(SK)||mk());setLoaded(true);},[]);
  const save=useCallback(d=>{sto.set(SK,d);},[]);
  const ud=data&&user?data[user]:null;

  const record=useCallback((wid,ok)=>{
    setData(prev=>{
      const u={...prev[user]};
      const wp=u.p[wid]||{c:0,i:0,s:0,lv:0};
      const nl=ok?Math.min(wp.lv+1,7):Math.max(wp.lv-1,0);
      u.p={...u.p,[wid]:{c:wp.c+(ok?1:0),i:wp.i+(ok?0:1),s:ok?wp.s+1:0,lv:nl,t:Date.now()}};
      if(ok)u.xp=(u.xp||0)+(nl>=5?15:10);
      u.lv=Math.floor((u.xp||0)/100)+1;
      const t=todayStr(),day=u.cal.d[t]||{r:0,w:0};
      day.r+=(ok?1:0);day.w+=(ok?0:1);
      u.cal.d={...u.cal.d,[t]:day};
      if(u.cal.last!==t){const y=new Date();y.setDate(y.getDate()-1);const ys=y.toISOString().split("T")[0];u.cal.s=u.cal.last===ys?u.cal.s+1:1;u.cal.b=Math.max(u.cal.b,u.cal.s);u.cal.last=t;}
      const next={...prev,[user]:u};save(next);return next;
    });
  },[user,save]);

  if(!loaded)return React.createElement("div",{style:{...PG,display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{fontSize:52,animation:"bn 1s infinite"}},"ğŸ“"));

  // PICK USER
  if(screen==="pick")return(
    <div style={{...PG,display:"flex",flexDirection:"column",justifyContent:"center",padding:"0 20px"}}>
      <div style={{textAlign:"center",marginBottom:36}}>
        <div style={{fontSize:42,marginBottom:4}}>ğŸ“</div>
        <div style={{fontSize:34,fontWeight:700,background:"linear-gradient(135deg,#FF6B35,#FFD700,#AA00FF)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>Spell It!</div>
      </div>
      {[{id:"asher",name:"Asher",emoji:"ğŸ¦",color:"#FF6B35",sub:"The Spelling King"},{id:"rivka",name:"Rivka",emoji:"â­",color:"#AA00FF",sub:"The Word Queen"}].map((u,i)=>{
        const d=data[u.id];
        return(
          <div key={u.id} onClick={()=>{setUser(u.id);setScreen("cats");}}
            style={{background:"linear-gradient(135deg,"+u.color+"22,"+u.color+"0A)",border:"2px solid "+u.color+"45",borderRadius:20,padding:"20px 18px",cursor:"pointer",display:"flex",alignItems:"center",gap:16,marginBottom:14,animation:"su "+(0.3+i*0.1)+"s ease"}}>
            <div style={{fontSize:40,width:56,height:56,background:u.color+"28",borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"}}>{u.emoji}</div>
            <div style={{flex:1}}>
              <div style={{fontSize:24,fontWeight:700}}>{u.name}</div>
              <div style={{fontSize:12,color:"rgba(255,255,255,0.35)"}}>{u.sub}</div>
            </div>
            <div style={{textAlign:"right"}}>
              {d.cal.s>0&&<div style={{fontSize:13,color:"#FFD700",fontWeight:600}}>{d.cal.s>=7?"ğŸ”¥":d.cal.s>=3?"âš¡":"âœ¨"} {d.cal.s}</div>}
              {d.lv>1&&<div style={{fontSize:11,color:"rgba(255,255,255,0.3)"}}>Lv {d.lv}</div>}
            </div>
          </div>
        );
      })}
      <div style={{textAlign:"center",marginTop:20,fontSize:11,color:"rgba(255,255,255,0.12)"}}>Built with â¤ï¸ for the Richter family</div>
    </div>
  );

  // CATEGORIES
  if(screen==="cats"){
    const ac=user==="asher"?"#FF6B35":"#AA00FF";
    const nm=user==="asher"?"Asher":"Rivka";
    const u=ud;
    const modes=[{id:"type",icon:"ğŸš€",nm:"Spell It"},{id:"unscramble",icon:"ğŸ”€",nm:"Unscramble"},{id:"fill",icon:"ğŸ•µï¸",nm:"Fill Gaps"},{id:"speed",icon:"âš¡",nm:"Speed"}];
    return(
      <div style={{...PG,padding:"0 0 60px"}}>
        <div style={{display:"flex",alignItems:"center",padding:"14px 16px 0",gap:8}}>
          <div onClick={()=>setScreen("pick")} style={{fontSize:13,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>â† Switch</div>
          <div style={{flex:1}}/>
          <div onClick={()=>setScreen("stats")} style={{fontSize:11,color:"rgba(255,255,255,0.2)",cursor:"pointer",padding:"4px 10px",borderRadius:8,background:"rgba(255,255,255,0.04)"}}>ğŸ“Š</div>
        </div>
        <div style={{padding:"10px 16px 4px",display:"flex",alignItems:"center",gap:8}}>
          <div style={{fontSize:22,fontWeight:700}}>Let's go, {nm}!</div>
          <div style={{fontSize:13,color:"#FFD700",fontWeight:600}}>{u.cal.s>=7?"ğŸ”¥":u.cal.s>=3?"âš¡":"âœ¨"}{u.cal.s} Â· Lv {u.lv}</div>
        </div>
        <div style={{display:"flex",gap:6,padding:"10px 16px 14px",overflowX:"auto"}}>
          {modes.map(m=>{const sel=cfg.mode===m.id;return(
            <div key={m.id} onClick={()=>setCfg({...cfg,mode:m.id})}
              style={{flex:"0 0 auto",padding:"8px 14px",borderRadius:10,cursor:"pointer",background:sel?ac+"28":"rgba(255,255,255,0.04)",border:sel?"2px solid "+ac:"2px solid transparent",display:"flex",alignItems:"center",gap:5}}>
              <span style={{fontSize:16}}>{m.icon}</span>
              <span style={{fontSize:13,fontWeight:600,color:sel?"#fff":"rgba(255,255,255,0.45)"}}>{m.nm}</span>
            </div>);
          })}
        </div>
        <div style={{padding:"0 16px"}}>
          <div onClick={()=>{setCfg(c=>({...c,track:"all"}));setScreen("session");}}
            style={{background:"linear-gradient(135deg,"+ac+"20,"+ac+"08)",border:"1px solid "+ac+"30",borderRadius:14,padding:"14px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:14,marginBottom:10,animation:"su 0.25s ease"}}>
            <div style={{fontSize:26}}>ğŸŒŸ</div>
            <div style={{flex:1}}><div style={{fontSize:16,fontWeight:600}}>Mix It Up</div><div style={{fontSize:11,color:"rgba(255,255,255,0.25)"}}>All categories shuffled</div></div>
          </div>
          {Object.entries(WORD_DB).map(([key,tr],i)=>{
            const n=tr.words.length;const m=tr.words.filter((_,j)=>(u.p[key+"_"+j]?.lv||0)>=7).length;const p=n>0?Math.round((m/n)*100):0;
            return(
              <div key={key} onClick={()=>{setCfg(c=>({...c,track:key}));setScreen("session");}}
                style={{background:tr.color+"0D",border:"1px solid "+tr.color+"20",borderRadius:14,padding:"13px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:14,marginBottom:7,animation:"su "+(0.25+i*0.04)+"s ease"}}>
                <div style={{fontSize:24}}>{tr.icon}</div>
                <div style={{flex:1}}><div style={{fontSize:14,fontWeight:600}}>{tr.name}</div>
                  <div style={{marginTop:4,height:4,borderRadius:2,background:"rgba(255,255,255,0.06)",overflow:"hidden"}}><div style={{height:"100%",width:p+"%",background:tr.color,borderRadius:2,transition:"width 0.5s"}}/></div>
                </div>
                <div style={{fontSize:13,fontWeight:700,color:tr.color}}>{p>0?p+"%":""}</div>
              </div>);
          })}
        </div>
      </div>
    );
  }

  // STATS
  if(screen==="stats"){
    const u=ud,ac=user==="asher"?"#FF6B35":"#AA00FF";
    const aw=allWords(),total=aw.length;
    const mst=Object.values(u.p).filter(w=>w.lv>=7).length;
    const lrn=Object.values(u.p).filter(w=>w.lv>0&&w.lv<7).length;
    const seen=Object.keys(u.p).length;
    const pct=total>0?Math.round((mst/total)*100):0;
    const t=todayStr(),td=u.cal.d[t];
    const now=new Date(),yr=now.getFullYear(),mo=now.getMonth();
    const dim=new Date(yr,mo+1,0).getDate(),fd=new Date(yr,mo,1).getDay();
    const moN=now.toLocaleDateString("en-US",{month:"long"});
    const grp={};aw.forEach(w=>{const lv=u.p[w.id]?.lv||0;const m=mast(lv);if(!grp[m.l])grp[m.l]=[];grp[m.l].push({...w,level:lv});});
    return(
      <div style={{...PG,padding:"0 0 60px"}}>
        <div onClick={()=>setScreen("cats")} style={{padding:"14px 16px 0",fontSize:13,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>â† Back</div>
        <div style={{padding:"8px 16px 12px",fontSize:20,fontWeight:700}}>ğŸ“Š {user==="asher"?"Asher":"Rivka"}'s Stats</div>
        <div style={{display:"flex",gap:8,padding:"0 16px",marginBottom:10}}>
          {[{v:"Lv "+u.lv,s:(u.xp||0)+" XP",c:ac},{v:(u.cal.s>=7?"ğŸ”¥":"âœ¨")+" "+u.cal.s,s:"best "+u.cal.b,c:"#FFD700"},{v:pct+"%",s:"mastered",c:"#00E676"}].map((x,i)=>(
            <div key={i} style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",textAlign:"center",border:"1px solid rgba(255,255,255,0.05)"}}>
              <div style={{fontSize:22,fontWeight:700,color:x.c}}>{x.v}</div>
              <div style={{fontSize:10,color:"rgba(255,255,255,0.25)"}}>{x.s}</div>
            </div>
          ))}
        </div>
        {td&&<div style={{display:"flex",gap:8,padding:"0 16px",marginBottom:10}}>
          {[{v:td.r,l:"Correct",c:"#00E676"},{v:td.r+td.w,l:"Practiced",c:"#2979FF"},{v:td.r+td.w>0?Math.round((td.r/(td.r+td.w))*100)+"%":"â€”",l:"Accuracy",c:"#FFD700"}].map((s,i)=>(
            <div key={i} style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:10,padding:"8px 4px",textAlign:"center",border:"1px solid rgba(255,255,255,0.04)"}}>
              <div style={{fontSize:18,fontWeight:700,color:s.c}}>{s.v}</div>
              <div style={{fontSize:9,color:"rgba(255,255,255,0.25)"}}>{s.l} today</div>
            </div>
          ))}
        </div>}
        <div style={{margin:"0 16px 10px",background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",border:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{textAlign:"center",fontSize:11,fontWeight:600,color:"rgba(255,255,255,0.3)",marginBottom:6}}>{moN} {yr}</div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,textAlign:"center"}}>
            {["S","M","T","W","T","F","S"].map((d,i)=><div key={i} style={{fontSize:8,color:"rgba(255,255,255,0.2)",padding:"2px 0",fontWeight:700}}>{d}</div>)}
            {Array.from({length:fd},(_,i)=><div key={"e"+i}/>)}
            {Array.from({length:dim},(_,i)=>{
              const day=i+1,ds=yr+"-"+String(mo+1).padStart(2,"0")+"-"+String(day).padStart(2,"0");
              const di=u.cal.d[ds],isT=ds===t;
              let bg="rgba(255,255,255,0.03)",brd="1px solid transparent";
              if(di&&di.r>=5){bg="rgba(0,230,118,0.25)";brd="1px solid rgba(0,230,118,0.4)";}
              else if(di&&di.r>0){bg="rgba(255,152,0,0.2)";}
              if(isT)brd="2px solid "+ac;
              return <div key={day} style={{aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5,background:bg,border:brd,fontSize:10,fontWeight:isT?700:400,color:isT?ac:"rgba(255,255,255,0.3)"}}>{day}</div>;
            })}
          </div>
        </div>
        <div style={{padding:"0 16px"}}>
          {["MASTERED","Almost Pro","Getting It","Learning","New"].map(label=>{
            const items=grp[label]||[];if(!items.length)return null;const m=mast(items[0].level);
            return(<div key={label} style={{marginBottom:12}}>
              <div style={{fontSize:12,fontWeight:600,color:m.c,marginBottom:5}}>{m.e} {label} ({items.length})</div>
              <div style={{display:"flex",flexWrap:"wrap",gap:4}}>{items.map(w=><div key={w.id} style={{background:m.c+"15",border:"1px solid "+m.c+"20",borderRadius:7,padding:"3px 10px",fontSize:12}}>{w.word}</div>)}</div>
            </div>);
          })}
        </div>
      </div>
    );
  }

  if(screen==="session")return <Sesh cfg={cfg} user={user} progress={ud.p} onAnswer={record} onExit={()=>setScreen("cats")}/>;
  return null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SESSION â€” The actual spelling practice
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLOW BY LEVEL:
// Level 0 (New):     SHOW word 3s â†’ word vanishes â†’ audio plays â†’ type it
// Level 1-3 (Learn): Audio auto-plays â†’ sentence + hint â†’ type it
// Level 4-5 (Adv):   Audio auto-plays â†’ sentence only â†’ type it
// Level 6-7 (Pro):   Audio auto-plays â†’ sentence only â†’ type it
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Sesh({cfg,user,progress,onAnswer,onExit}){
  const[words,setWords]=useState([]);
  const[idx,setIdx]=useState(0);
  const[input,setInput]=useState("");
  const[fb,setFb]=useState(null);
  const[stats,setStats]=useState({r:0,w:0});
  const[done,setDone]=useState(false);
  const[burst,setBurst]=useState(false);
  const[msg,setMsg]=useState("");
  const[timer,setTimer]=useState(cfg.mode==="speed"?45:null);
  const[scram,setScram]=useState([]);
  const[picked,setPicked]=useState([]);
  const[gaps,setGaps]=useState(null);
  const[gapIn,setGapIn]=useState("");
  // NEW: study phase for new words
  const[phase,setPhase]=useState("ready"); // "study" | "ready"
  const[studyCountdown,setStudyCountdown]=useState(0);
  const ac=user==="asher"?"#FF6B35":"#AA00FF";

  useEffect(()=>{
    const all=allWords();
    let pool=cfg.track==="all"?all:all.filter(w=>w.track===cfg.track);
    pool.sort((a,b)=>{const la=progress[a.id]?.lv||0,lb=progress[b.id]?.lv||0;if(la===0&&lb!==0)return-1;if(lb===0&&la!==0)return 1;return la-lb;});
    setWords(shuffle(pool.slice(0,Math.min(cfg.mode==="speed"?15:5,pool.length))));
  },[cfg.track,cfg.mode]);

  // Speed timer
  useEffect(()=>{if(cfg.mode==="speed"&&timer>0&&!done){const t=setTimeout(()=>setTimer(s=>s-1),1000);return()=>clearTimeout(t);}if(cfg.mode==="speed"&&timer===0)setDone(true);},[timer,cfg.mode,done]);

  // WORD PRESENTATION LOGIC
  useEffect(()=>{
    if(!words[idx])return;
    const cw=words[idx];
    const lv=progress[cw.id]?.lv||0;

    if((cfg.mode==="type"||cfg.mode==="speed")&&lv===0){
      // NEW WORD: show it for study, then hide
      setPhase("study");
      setStudyCountdown(3);
      speak(cw.word,0.7);
    } else if(cfg.mode==="type"||cfg.mode==="speed"){
      // KNOWN WORD: just play audio, go straight to typing
      setPhase("ready");
      speak(cw.word,0.7);
    } else {
      setPhase("ready");
    }
  },[idx,words,cfg.mode]);

  // Study countdown timer
  useEffect(()=>{
    if(phase==="study"&&studyCountdown>0){
      const t=setTimeout(()=>setStudyCountdown(s=>s-1),1000);
      return()=>clearTimeout(t);
    }
    if(phase==="study"&&studyCountdown===0){
      setPhase("ready");
      // Play audio again right when it switches to typing
      if(words[idx]) speak(words[idx].word,0.7);
    }
  },[phase,studyCountdown]);

  // Unscramble setup
  useEffect(()=>{if(cfg.mode==="unscramble"&&words[idx]){let s=shuffle(words[idx].word.split(""));let t=0;while(s.join("").toLowerCase()===words[idx].word.toLowerCase()&&words[idx].word.length>2&&t<10){s=shuffle(words[idx].word.split(""));t++;}setScram(s);setPicked([]);speak(words[idx].word,0.7);}},[idx,words,cfg.mode]);

  // Fill gaps setup
  useEffect(()=>{if(cfg.mode==="fill"&&words[idx]){const w=words[idx].word,lv=progress[words[idx].id]?.lv||0;const rn=Math.min(Math.max(1,Math.floor(w.length*(0.25+lv*0.05))),w.length-2);const ix=new Set();while(ix.size<rn){ix.add(1+Math.floor(Math.random()*(w.length-1)));}setGaps({ch:w.split("").map((c,i)=>ix.has(i)?null:c)});setGapIn("");speak(words[idx].word,0.7);}},[idx,words,cfg.mode]);

  const cw=words[idx];if(!cw&&!done)return null;
  const wLv=cw?(progress[cw.id]?.lv||0):0;
  // Hint visibility: show for levels 0-3, hide for 4+
  const showHint=wLv<=3;

  const advance=()=>{setFb(null);setInput("");setGapIn("");setPhase("ready");if(idx+1>=words.length)setDone(true);else setIdx(i=>i+1);};
  const doOk=()=>{onAnswer(cw.id,true);setStats(s=>({...s,r:s.r+1}));setFb("ok");setMsg(rand(FIRE));setBurst(true);speak("Yes!");setTimeout(()=>{setBurst(false);advance();},1100);};
  const doNo=()=>{onAnswer(cw.id,false);setStats(s=>({...s,w:s.w+1}));setFb("no");setMsg(rand(MISS));speak("It's spelled: "+cw.word.split("").join(", "));setTimeout(advance,2500);};
  const doCl=()=>{onAnswer(cw.id,false);setStats(s=>({...s,w:s.w+1}));setFb("cl");setMsg('So close! It\'s "'+cw.word+'"');speak("Almost! "+cw.word);setTimeout(advance,2000);};
  const sub=()=>{if(!input.trim()||phase==="study")return;const r=chk(input,cw.word);if(r==="exact")doOk();else if(r==="close")doCl();else doNo();};
  const subG=()=>{if(!gapIn.trim())return;const r=chk(gapIn,cw.word);if(r==="exact")doOk();else if(r==="close")doCl();else doNo();};
  const tapS=(l,i)=>{const ns=[...scram];ns.splice(i,1);setScram(ns);const np=[...picked,l];setPicked(np);if(np.length===cw.word.length){if(np.join("").toLowerCase()===cw.word.toLowerCase())setTimeout(doOk,250);else setTimeout(()=>{doNo();setPicked([]);setScram(shuffle(cw.word.split("")));},250);}};
  const untap=(l,i)=>{const np=[...picked];np.splice(i,1);setPicked(np);setScram([...scram,l]);};

  // DONE SCREEN
  if(done){
    const tot=stats.r+stats.w,pct=tot>0?Math.round((stats.r/tot)*100):0;
    const em=pct>=90?"ğŸ‘‘":pct>=70?"ğŸ†":pct>=50?"â­":"ğŸ’ª";
    const ln=pct>=90?"ABSOLUTE LEGEND!":pct>=70?"Great session!":pct>=50?"Solid work!":"Keep going â€” you got this!";
    return(
      <div style={{...PG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:24}}>
        <div style={{fontSize:68,marginBottom:10,animation:"bn 0.8s ease"}}>{em}</div>
        <div style={{fontSize:24,fontWeight:700,marginBottom:4}}>{ln}</div>
        <div style={{fontSize:14,color:"rgba(255,255,255,0.4)",marginBottom:20}}>{stats.r} correct Â· {stats.w} missed Â· {pct}%</div>
        <div style={{display:"flex",flexWrap:"wrap",gap:6,justifyContent:"center",marginBottom:28}}>
          {words.map(w=><div key={w.id} style={{background:"rgba(255,255,255,0.05)",borderRadius:8,padding:"5px 12px",fontSize:13}}>{w.word}</div>)}
        </div>
        <div onClick={onExit} style={{background:"linear-gradient(135deg,"+ac+","+ac+"CC)",borderRadius:14,padding:"14px 44px",cursor:"pointer",fontSize:17,fontWeight:700,boxShadow:"0 4px 20px "+ac+"40"}}>Done</div>
        <div onClick={()=>{setIdx(0);setStats({r:0,w:0});setDone(false);setFb(null);setInput("");setPhase("ready");if(cfg.mode==="speed")setTimer(45);}}
          style={{marginTop:12,fontSize:14,color:ac,cursor:"pointer",fontWeight:600}}>ğŸ”„ Again</div>
      </div>
    );
  }

  const progPct=words.length>0?((idx)/words.length)*100:0;
  const fbC=fb==="ok"?"#00E676":fb==="cl"?"#FFD700":"#FF5252";

  return(
    <div style={{...PG,display:"flex",flexDirection:"column"}}>
      {burst&&<Bst/>}
      {/* Top bar */}
      <div style={{display:"flex",alignItems:"center",padding:"14px 16px 8px",gap:10}}>
        <div onClick={onExit} style={{fontSize:14,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>âœ•</div>
        <div style={{flex:1,height:6,borderRadius:3,background:"rgba(255,255,255,0.07)",overflow:"hidden"}}>
          <div style={{height:"100%",width:progPct+"%",background:"linear-gradient(90deg,"+ac+",#FFD700)",borderRadius:3,transition:"width 0.4s"}}/>
        </div>
        <div style={{fontSize:13,color:"rgba(255,255,255,0.3)",minWidth:36,textAlign:"right"}}>{idx+1}/{words.length}</div>
        {cfg.mode==="speed"&&<div style={{fontSize:16,fontWeight:700,color:timer<=10?"#FF5252":"#FFD700",animation:timer<=10?"pu 0.5s infinite":"none"}}>{timer}s</div>}
      </div>

      {/* Main content */}
      <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0 20px"}}>

        {/* Category label */}
        <div style={{fontSize:10,color:"rgba(255,255,255,0.2)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:6}}>{WORD_DB[cw.track]?.icon} {WORD_DB[cw.track]?.name}</div>

        {/* â•â•â• STUDY PHASE (New words only) â•â•â• */}
        {(cfg.mode==="type"||cfg.mode==="speed")&&phase==="study"&&(
          <React.Fragment>
            <div style={{fontSize:12,color:"#FFD700",fontWeight:600,marginBottom:8,textTransform:"uppercase",letterSpacing:2}}>ğŸ“– Study this word!</div>
            <div style={{fontSize:38,fontWeight:700,color:"#FFD700",letterSpacing:4,marginBottom:12,animation:"glowPulse 2s ease infinite"}}>{cw.word}</div>
            <div style={{fontSize:14,color:"rgba(255,255,255,0.5)",fontStyle:"italic",marginBottom:8,textAlign:"center"}}>"{cw.sentence}"</div>
            <div style={{fontSize:13,color:"rgba(255,255,255,0.35)"}}>ğŸ’¡ {cw.hint}</div>
            <div style={{marginTop:20,fontSize:48,fontWeight:700,color:ac,animation:"pu 1s infinite"}}>{studyCountdown}</div>
            <div style={{fontSize:12,color:"rgba(255,255,255,0.3)",marginTop:4}}>Remember the spelling...</div>
          </React.Fragment>
        )}

        {/* â•â•â• TYPING PHASE (type/speed modes) â•â•â• */}
        {(cfg.mode==="type"||cfg.mode==="speed")&&phase==="ready"&&!fb&&(
          <React.Fragment>
            <div style={{fontSize:16,color:"rgba(255,255,255,0.5)",textAlign:"center",marginBottom:10,lineHeight:1.5,fontStyle:"italic",maxWidth:300}}>"{cw.sentence}"</div>
            <div onClick={()=>speak(cw.word,0.7)} style={{fontSize:15,color:ac,cursor:"pointer",marginBottom:12,padding:"8px 20px",borderRadius:10,background:ac+"15",border:"1px solid "+ac+"30"}}>ğŸ”Š Hear it again</div>
            {showHint&&<div style={{fontSize:13,color:"rgba(255,255,255,0.3)",marginBottom:8}}>ğŸ’¡ {cw.hint}</div>}
            <div style={{fontSize:12,color:"rgba(255,255,255,0.2)",marginTop:4}}>
              {wLv===0?"First time â€” you got this!":"Spell what you hear"}
            </div>
          </React.Fragment>
        )}

        {/* â•â•â• UNSCRAMBLE MODE â•â•â• */}
        {cfg.mode==="unscramble"&&!fb&&(
          <React.Fragment>
            <div style={{fontSize:15,color:"rgba(255,255,255,0.5)",textAlign:"center",marginBottom:8,fontStyle:"italic"}}>"{cw.sentence}"</div>
            <div onClick={()=>speak(cw.word,0.7)} style={{fontSize:13,color:ac,cursor:"pointer",marginBottom:10}}>ğŸ”Š Hear it</div>
            {showHint&&<div style={{fontSize:12,color:"rgba(255,255,255,0.25)",marginBottom:10}}>ğŸ’¡ {cw.hint}</div>}
            <div style={{display:"flex",gap:5,marginBottom:12,minHeight:44,flexWrap:"wrap",justifyContent:"center"}}>
              {cw.word.split("").map((_,i)=>(
                <div key={i} onClick={()=>picked[i]&&untap(picked[i],i)}
                  style={{width:35,height:42,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,cursor:picked[i]?"pointer":"default",background:picked[i]?ac+"25":"rgba(255,255,255,0.03)",border:picked[i]?"2px solid "+ac+"60":"2px dashed rgba(255,255,255,0.08)",color:picked[i]?"#fff":"transparent"}}>{picked[i]||""}</div>
              ))}
            </div>
            <div style={{display:"flex",gap:7,flexWrap:"wrap",justifyContent:"center"}}>
              {scram.map((l,i)=>(
                <div key={i} onClick={()=>tapS(l,i)}
                  style={{width:42,height:48,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,cursor:"pointer",background:"rgba(255,255,255,0.07)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"}}>{l}</div>
              ))}
            </div>
          </React.Fragment>
        )}

        {/* â•â•â• FILL GAPS MODE â•â•â• */}
        {cfg.mode==="fill"&&gaps&&!fb&&(
          <React.Fragment>
            <div style={{fontSize:15,color:"rgba(255,255,255,0.5)",textAlign:"center",marginBottom:8,fontStyle:"italic"}}>"{cw.sentence}"</div>
            <div onClick={()=>speak(cw.word,0.7)} style={{fontSize:13,color:ac,cursor:"pointer",marginBottom:10}}>ğŸ”Š Hear it</div>
            {showHint&&<div style={{fontSize:12,color:"rgba(255,255,255,0.25)",marginBottom:12}}>ğŸ’¡ {cw.hint}</div>}
            <div style={{display:"flex",gap:4,marginBottom:16,justifyContent:"center",flexWrap:"wrap"}}>
              {gaps.ch.map((c,i)=>(
                <div key={i} style={{width:31,height:40,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,background:c?"rgba(255,255,255,0.05)":ac+"15",border:c?"1px solid rgba(255,255,255,0.06)":"2px dashed "+ac+"50",color:c?"rgba(255,255,255,0.6)":ac}}>{c||"?"}</div>
              ))}
            </div>
            <div style={{fontSize:11,color:"rgba(255,255,255,0.2)",marginBottom:6}}>Type the full word:</div>
          </React.Fragment>
        )}

        {/* â•â•â• FEEDBACK (all modes) â•â•â• */}
        {fb&&(
          <React.Fragment>
            {fb==="no"&&<div style={{fontSize:28,fontWeight:700,color:"#FFD700",letterSpacing:3,marginBottom:8,animation:"su 0.3s ease"}}>{cw.word}</div>}
            {fb==="no"&&<div style={{fontSize:12,color:"rgba(255,255,255,0.35)",marginBottom:6}}>Study it â€” you'll get it next time!</div>}
            {fb==="cl"&&<div style={{fontSize:24,fontWeight:700,color:"#FFD700",letterSpacing:2,marginBottom:8,animation:"su 0.3s ease"}}>{cw.word}</div>}
            <div style={{fontSize:18,fontWeight:700,color:fbC,animation:"su 0.3s ease",textAlign:"center"}}>{msg}</div>
          </React.Fragment>
        )}
      </div>

      {/* â•â•â• INPUT BAR â•â•â• */}
      {(cfg.mode==="type"||cfg.mode==="speed")&&phase==="ready"&&!fb&&(
        <div style={{padding:"12px 16px 20px",background:"rgba(0,0,0,0.2)",borderTop:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{display:"flex",gap:10}}>
            <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")sub();}}
              placeholder="Spell the word..." autoFocus autoCapitalize="none" autoCorrect="off" spellCheck="false"
              style={{flex:1,padding:"14px 16px",borderRadius:12,border:"2px solid "+ac+"40",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:18,fontFamily:FNT,outline:"none",letterSpacing:1}}/>
            <div onClick={sub} style={{padding:"14px 20px",borderRadius:12,background:ac,cursor:"pointer",fontSize:16,fontWeight:700,display:"flex",alignItems:"center"}}>Go âœ</div>
          </div>
        </div>
      )}
      {cfg.mode==="fill"&&!fb&&(
        <div style={{padding:"12px 16px 20px",background:"rgba(0,0,0,0.2)",borderTop:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{display:"flex",gap:10}}>
            <input value={gapIn} onChange={e=>setGapIn(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")subG();}}
              placeholder="Type the full word..." autoFocus autoCapitalize="none" autoCorrect="off" spellCheck="false"
              style={{flex:1,padding:"14px 16px",borderRadius:12,border:"2px solid "+ac+"40",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:18,fontFamily:FNT,outline:"none",letterSpacing:1}}/>
            <div onClick={subG} style={{padding:"14px 20px",borderRadius:12,background:ac,cursor:"pointer",fontSize:16,fontWeight:700,display:"flex",alignItems:"center"}}>Go âœ</div>
          </div>
        </div>
      )}
    </div>
  );
}

function Bst(){
  const ps=Array.from({length:14},(_,i)=>({x:(Math.random()-0.5)*220,y:(Math.random()-0.5)*220-40,s:Math.random()*10+5,c:["#FFD700","#FF6B35","#00E676","#2979FF","#E91E63","#AA00FF"][i%6],d:Math.random()*0.3}));
  return(<div style={{position:"fixed",top:"35%",left:"50%",pointerEvents:"none",zIndex:999}}>
    {ps.map((p,i)=><div key={i} style={{position:"absolute",width:p.s,height:p.s,background:p.c,borderRadius:p.s>9?"50%":"2px","--tx":p.x+"px","--ty":p.y+"px",animation:"cb 0.9s ease-out "+p.d+"s forwards",opacity:0}}/>)}
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
