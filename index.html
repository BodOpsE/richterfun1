<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="theme-color" content="#0B0E17"/>
<title>Spell It! ‚Äî Richter Fun</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
html,body,#root{height:100%;font-family:'Fredoka',sans-serif}
body{background:#0B0E17;overflow-x:hidden}
@keyframes su{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes bn{0%,100%{transform:scale(1)}40%{transform:scale(1.15)}70%{transform:scale(0.95)}}
@keyframes pu{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
@keyframes gl{0%,100%{box-shadow:0 4px 20px rgba(255,107,53,0.3)}50%{box-shadow:0 4px 30px rgba(255,107,53,0.55)}}
@keyframes cb{0%{opacity:1;transform:translate(0,0) scale(0) rotate(0)}40%{opacity:1}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(1.3) rotate(720deg)}}
input::placeholder{color:rgba(255,255,255,0.25)}
input:focus{outline:none}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

const STORAGE_KEY="spell_app_v3";
const store={
  get:k=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):null}catch{return null}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch(e){}}
};

const FIRE=["LEGEND! üî•","Benny Friedman approved! üé§","GESHMAK! ‚ú®","Mamash amazing! üíé","Chanukah menorah energy! üïé","Ishay Ribo level! üé∂","GADOL move! üèÜ","Shabbos cholent vibes! üç≤","Mordechai Shapiro says WOW! üéµ","BOSS! üëë","Fresh challah smooth! üçû","MaccaBeats remix! üéß","PRO! üí™","Zusha energy! üåü","Built like a sukkah! üèóÔ∏è","Eight Nights of W's! üïé","Shepping nachas! ‚ù§Ô∏è","Tzaddik move! ‚ú°Ô∏è"];
const MISS=["Almost! Next one's yours üí™","So close! Even Moshe needed tries üåü","Not yet ‚Äî getting stronger ‚ö°","That's how we learn üìñ","Winners keep going üèÜ","Close! Get the next one üéØ","Maccabees lost rounds too ‚≠ê"];

const WORD_DB={
  double_trouble:{name:"Double Trouble",icon:"‚úåÔ∏è",color:"#FF6B35",desc:"Tricky double letters",words:[
    {word:"accommodate",hint:"cc + mm",sentence:"The hotel can ___ 200 guests.",diff:3},
    {word:"occurrence",hint:"cc + rr",sentence:"This is a rare ___.",diff:3},
    {word:"committee",hint:"mm + tt + ee ‚Äî triple!",sentence:"The ___ voted on new rules.",diff:2},
    {word:"necessary",hint:"1 Collar(c), 2 Socks(s)",sentence:"Water is ___ for life.",diff:2},
    {word:"occasion",hint:"cc but only 1 s",sentence:"A birthday is a special ___.",diff:2},
    {word:"recommend",hint:"1 c, 2 m's",sentence:"I ___ this book.",diff:2},
    {word:"tomorrow",hint:"1 m, 2 r's",sentence:"___ is another day.",diff:1},
    {word:"disappear",hint:"1 s, 2 p's ‚Äî poof!",sentence:"Watch it ___.",diff:1},
    {word:"balloon",hint:"ll + oo ‚Äî puffy!",sentence:"The red ___ floated away.",diff:1},
    {word:"broccoli",hint:"cc but only 1 l",sentence:"Eat your ___.",diff:2},
    {word:"embarrass",hint:"rr + ss",sentence:"Don't ___ me!",diff:3},
    {word:"misspell",hint:"ss ‚Äî ironic!",sentence:"Don't ___ words.",diff:2}
  ]},
  ninja_letters:{name:"Ninja Letters",icon:"ü•∑",color:"#7C4DFF",desc:"Silent letters hiding",words:[
    {word:"knowledge",hint:"silent K",sentence:"___ is power.",diff:2},
    {word:"rhythm",hint:"no regular vowels!",sentence:"Keep a steady ___.",diff:3},
    {word:"Wednesday",hint:"silent D",sentence:"Pizza every ___.",diff:2},
    {word:"knight",hint:"silent K + GH",sentence:"The ___ rode into battle.",diff:1},
    {word:"wrinkle",hint:"silent W",sentence:"Iron out every ___.",diff:1},
    {word:"scissors",hint:"silent C",sentence:"Cut with ___.",diff:2},
    {word:"subtle",hint:"silent B",sentence:"A ___ difference.",diff:2},
    {word:"psychology",hint:"silent P",sentence:"She studies ___.",diff:3},
    {word:"gnaw",hint:"silent G",sentence:"Dogs ___ on bones.",diff:1},
    {word:"column",hint:"silent N",sentence:"Read the first ___.",diff:2},
    {word:"island",hint:"silent S",sentence:"A tropical ___.",diff:1},
    {word:"listen",hint:"silent T",sentence:"___ carefully.",diff:1}
  ]},
  ie_battle:{name:"I vs E Showdown",icon:"‚öîÔ∏è",color:"#2979FF",desc:"IE or EI?",words:[
    {word:"believe",hint:"I before E",sentence:"I ___ you can do it!",diff:1},
    {word:"receive",hint:"EI after C",sentence:"Did you ___ my message?",diff:2},
    {word:"achieve",hint:"I before E",sentence:"You can ___ your goals.",diff:1},
    {word:"weird",hint:"EI ‚Äî word IS weird",sentence:"That was really ___.",diff:1},
    {word:"their",hint:"EI ‚Äî exception!",sentence:"___ house is big.",diff:1},
    {word:"ceiling",hint:"EI after C",sentence:"The ___ fan spins.",diff:2},
    {word:"neither",hint:"EI ‚Äî exception",sentence:"___ answer is right.",diff:2},
    {word:"protein",hint:"EI",sentence:"Chicken has ___.",diff:2},
    {word:"seize",hint:"EI",sentence:"___ the day!",diff:2},
    {word:"foreign",hint:"EI",sentence:"A ___ language.",diff:2},
    {word:"science",hint:"IE after SC",sentence:"___ class is fun.",diff:1},
    {word:"shield",hint:"IE",sentence:"Captain America's ___.",diff:1}
  ]},
  endings:{name:"-TION vs -SION",icon:"üéØ",color:"#E91E63",desc:"Which ending?",words:[
    {word:"education",hint:"-TION",sentence:"Getting an ___ matters.",diff:1},
    {word:"permission",hint:"-SION (permit‚Üí)",sentence:"Ask for ___ first.",diff:2},
    {word:"competition",hint:"-TION",sentence:"The spelling ___.",diff:2},
    {word:"television",hint:"-SION (has vision)",sentence:"Watched ___.",diff:1},
    {word:"explanation",hint:"-TION",sentence:"Give me an ___.",diff:2},
    {word:"decision",hint:"-SION (decide‚Üí)",sentence:"A tough ___.",diff:2},
    {word:"imagination",hint:"-TION",sentence:"Use your ___!",diff:1},
    {word:"expression",hint:"-SION",sentence:"A funny ___.",diff:2},
    {word:"celebration",hint:"-TION",sentence:"Birthday ___!",diff:1},
    {word:"confusion",hint:"-SION (confuse‚Üí)",sentence:"Lots of ___.",diff:2},
    {word:"preparation",hint:"-TION",sentence:"___ is key.",diff:2},
    {word:"explosion",hint:"-SION ‚Äî BOOM!",sentence:"A loud ___.",diff:2}
  ]},
  most_wanted:{name:"Most Wanted",icon:"üî•",color:"#FF9800",desc:"Everyone gets these wrong",words:[
    {word:"definitely",hint:"FINITE is inside!",sentence:"I'll ___ be there.",diff:3},
    {word:"separate",hint:"A RAT is in there!",sentence:"___ the colors.",diff:2},
    {word:"different",hint:"2 f's, 1 r",sentence:"Each person is ___.",diff:1},
    {word:"beginning",hint:"double N",sentence:"Just the ___.",diff:2},
    {word:"because",hint:"Big Elephants Can Always Understand Small Elephants",sentence:"I stayed home ___.",diff:1},
    {word:"beautiful",hint:"beau-ti-ful",sentence:"A ___ sunset!",diff:1},
    {word:"calendar",hint:"-AR not -ER",sentence:"Mark the ___.",diff:2},
    {word:"February",hint:"keep the first R!",sentence:"___ is short.",diff:2},
    {word:"library",hint:"2 R's",sentence:"Books from the ___.",diff:1},
    {word:"restaurant",hint:"AU in the middle",sentence:"Eat at the ___.",diff:3},
    {word:"surprise",hint:"SUR not SER",sentence:"A ___!",diff:2},
    {word:"environment",hint:"N before M",sentence:"Protect the ___.",diff:3},
    {word:"government",hint:"N before M",sentence:"The ___ passed a law.",diff:2},
    {word:"temperature",hint:"temper-A-ture",sentence:"The ___ dropped.",diff:2},
    {word:"immediately",hint:"double M",sentence:"Come ___!",diff:3},
    {word:"independent",hint:"-ENT not -ANT",sentence:"She is ___.",diff:3}
  ]},
  able_ible:{name:"-ABLE or -IBLE?",icon:"üß©",color:"#00BCD4",desc:"Which ending?",words:[
    {word:"comfortable",hint:"-ABLE",sentence:"Very ___.",diff:1},
    {word:"responsible",hint:"-IBLE",sentence:"Be ___.",diff:2},
    {word:"available",hint:"-ABLE",sentence:"Is this ___?",diff:2},
    {word:"incredible",hint:"-IBLE",sentence:"That was ___!",diff:1},
    {word:"reasonable",hint:"-ABLE",sentence:"A ___ price.",diff:2},
    {word:"terrible",hint:"-IBLE",sentence:"___ weather.",diff:1},
    {word:"valuable",hint:"-ABLE",sentence:"Time is ___.",diff:2},
    {word:"impossible",hint:"-IBLE",sentence:"Nothing is ___!",diff:1},
    {word:"favorable",hint:"-ABLE",sentence:"___ reviews.",diff:2},
    {word:"flexible",hint:"-IBLE",sentence:"Be ___.",diff:2},
    {word:"adorable",hint:"-ABLE",sentence:"An ___ puppy.",diff:1},
    {word:"visible",hint:"-IBLE",sentence:"Stars are ___.",diff:1}
  ]}
};

const todayStr=()=>new Date().toISOString().split("T")[0];
const rand=a=>a[Math.floor(Math.random()*a.length)];
const shuffle=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};
const speak=(t,r=0.8)=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);u.rate=r;u.lang="en-US";window.speechSynthesis.speak(u);}};
const allWords=()=>{const a=[];Object.entries(WORD_DB).forEach(([k,t])=>t.words.forEach((w,i)=>a.push({...w,id:`${k}_${i}`,track:k})));return a;};
const lev=(a,b)=>{const m=a.length,n=b.length,d=Array.from({length:m+1},()=>Array(n+1).fill(0));for(let i=0;i<=m;i++)d[i][0]=i;for(let j=0;j<=n;j++)d[0][j]=j;for(let i=1;i<=m;i++)for(let j=1;j<=n;j++)d[i][j]=a[i-1]===b[j-1]?d[i-1][j-1]:1+Math.min(d[i-1][j],d[i][j-1],d[i-1][j-1]);return d[m][n];};
const chk=(inp,cor)=>{const a=inp.trim().toLowerCase(),c=cor.toLowerCase();if(a===c)return"exact";if(lev(a,c)===1&&c.length>3)return"close";return"wrong";};
const scaf=(w,lv)=>{if(lv<=1)return w;if(lv<=3)return w[0]+" ¬∑ ".repeat(Math.max(0,w.length-2))+w[w.length-1];if(lv<=5)return w[0]+" ¬∑ ".repeat(w.length-1);return "¬∑ ".repeat(w.length);};
const mast=lv=>{if(lv===0)return{l:"New",c:"#78909C",e:"üÜï"};if(lv<=2)return{l:"Learning",c:"#FF9800",e:"üìñ"};if(lv<=4)return{l:"Getting It",c:"#2979FF",e:"üí™"};if(lv<=6)return{l:"Almost Pro",c:"#AA00FF",e:"‚≠ê"};return{l:"MASTERED",c:"#00E676",e:"üèÜ"};};

const FNT="'Fredoka',sans-serif";
const PG={minHeight:"100vh",background:"linear-gradient(160deg,#0B0E17 0%,#151A2E 50%,#0D1220 100%)",color:"#fff",fontFamily:FNT,overflow:"auto"};

function App(){
  const[data,setData]=useState(null);
  const[loaded,setLoaded]=useState(false);
  const[screen,setScreen]=useState("pick");
  const[user,setUser]=useState(null);
  const[cfg,setCfg]=useState({track:null,mode:"type"});

  const mk=()=>({asher:{p:{},cal:{d:{},s:0,b:0,last:null},xp:0,lv:1},rivka:{p:{},cal:{d:{},s:0,b:0,last:null},xp:0,lv:1}});

  useEffect(()=>{setData(store.get(STORAGE_KEY)||mk());setLoaded(true);},[]);
  const save=useCallback(d=>{store.set(STORAGE_KEY,d);},[]);
  const ud=data&&user?data[user]:null;

  const record=useCallback((wid,ok)=>{
    setData(prev=>{
      const u={...prev[user]};
      const wp=u.p[wid]||{c:0,i:0,s:0,lv:0};
      const nl=ok?Math.min(wp.lv+1,7):Math.max(wp.lv-1,0);
      u.p={...u.p,[wid]:{c:wp.c+(ok?1:0),i:wp.i+(ok?0:1),s:ok?wp.s+1:0,lv:nl,t:Date.now()}};
      if(ok)u.xp=(u.xp||0)+(nl>=5?15:10);
      u.lv=Math.floor((u.xp||0)/100)+1;
      const t=todayStr(),day=u.cal.d[t]||{r:0,w:0};
      day.r+=(ok?1:0);day.w+=(ok?0:1);
      u.cal.d={...u.cal.d,[t]:day};
      if(u.cal.last!==t){const y=new Date();y.setDate(y.getDate()-1);const ys=y.toISOString().split("T")[0];u.cal.s=u.cal.last===ys?u.cal.s+1:1;u.cal.b=Math.max(u.cal.b,u.cal.s);u.cal.last=t;}
      const next={...prev,[user]:u};save(next);return next;
    });
  },[user,save]);

  if(!loaded)return React.createElement("div",{style:{...PG,display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{fontSize:52,animation:"bn 1s infinite"}},"üìù"));

  // PICK USER
  if(screen==="pick")return(
    <div style={{...PG,display:"flex",flexDirection:"column",justifyContent:"center",padding:"0 20px"}}>
      <div style={{textAlign:"center",marginBottom:36}}>
        <div style={{fontSize:42,marginBottom:4}}>üìù</div>
        <div style={{fontSize:34,fontWeight:700,background:"linear-gradient(135deg,#FF6B35,#FFD700,#AA00FF)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>Spell It!</div>
      </div>
      {[
        {id:"asher",name:"Asher",emoji:"ü¶Å",color:"#FF6B35",sub:"The Spelling King"},
        {id:"rivka",name:"Rivka",emoji:"‚≠ê",color:"#AA00FF",sub:"The Word Queen"},
      ].map((u,i)=>{
        const d=data[u.id];
        return(
          <div key={u.id} onClick={()=>{setUser(u.id);setScreen("cats");}}
            style={{background:`linear-gradient(135deg,${u.color}22,${u.color}0A)`,border:`2px solid ${u.color}45`,borderRadius:20,padding:"20px 18px",cursor:"pointer",display:"flex",alignItems:"center",gap:16,marginBottom:14,animation:`su ${0.3+i*0.1}s ease`}}>
            <div style={{fontSize:40,width:56,height:56,background:`${u.color}28`,borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"}}>{u.emoji}</div>
            <div style={{flex:1}}>
              <div style={{fontSize:24,fontWeight:700}}>{u.name}</div>
              <div style={{fontSize:12,color:"rgba(255,255,255,0.35)"}}>{u.sub}</div>
            </div>
            <div style={{textAlign:"right"}}>
              {d.cal.s>0&&<div style={{fontSize:13,color:"#FFD700",fontWeight:600}}>{d.cal.s>=7?"üî•":d.cal.s>=3?"‚ö°":"‚ú®"} {d.cal.s}</div>}
              {d.lv>1&&<div style={{fontSize:11,color:"rgba(255,255,255,0.3)"}}>Lv {d.lv}</div>}
            </div>
          </div>
        );
      })}
      <div style={{textAlign:"center",marginTop:20,fontSize:11,color:"rgba(255,255,255,0.12)"}}>Built with ‚ù§Ô∏è for the Richter family</div>
    </div>
  );

  // CATEGORIES
  if(screen==="cats"){
    const ac=user==="asher"?"#FF6B35":"#AA00FF";
    const nm=user==="asher"?"Asher":"Rivka";
    const u=ud;
    const modes=[{id:"type",icon:"üöÄ",nm:"Spell It"},{id:"unscramble",icon:"üîÄ",nm:"Unscramble"},{id:"fill",icon:"üïµÔ∏è",nm:"Fill Gaps"},{id:"speed",icon:"‚ö°",nm:"Speed"}];
    return(
      <div style={{...PG,padding:"0 0 60px"}}>
        <div style={{display:"flex",alignItems:"center",padding:"14px 16px 0",gap:8}}>
          <div onClick={()=>setScreen("pick")} style={{fontSize:13,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>‚Üê Switch</div>
          <div style={{flex:1}}/>
          <div onClick={()=>setScreen("stats")} style={{fontSize:11,color:"rgba(255,255,255,0.2)",cursor:"pointer",padding:"4px 10px",borderRadius:8,background:"rgba(255,255,255,0.04)"}}>üìä</div>
        </div>
        <div style={{padding:"10px 16px 4px",display:"flex",alignItems:"center",gap:8}}>
          <div style={{fontSize:22,fontWeight:700}}>Let's go, {nm}!</div>
          <div style={{fontSize:13,color:"#FFD700",fontWeight:600}}>{u.cal.s>=7?"üî•":u.cal.s>=3?"‚ö°":"‚ú®"}{u.cal.s} ¬∑ Lv {u.lv}</div>
        </div>
        <div style={{display:"flex",gap:6,padding:"10px 16px 14px",overflowX:"auto"}}>
          {modes.map(m=>{
            const sel=cfg.mode===m.id;
            return(<div key={m.id} onClick={()=>setCfg({...cfg,mode:m.id})}
              style={{flex:"0 0 auto",padding:"8px 14px",borderRadius:10,cursor:"pointer",textAlign:"center",
                background:sel?`${ac}28`:"rgba(255,255,255,0.04)",border:sel?`2px solid ${ac}`:"2px solid transparent",
                display:"flex",alignItems:"center",gap:5}}>
              <span style={{fontSize:16}}>{m.icon}</span>
              <span style={{fontSize:13,fontWeight:600,color:sel?"#fff":"rgba(255,255,255,0.45)"}}>{m.nm}</span>
            </div>);
          })}
        </div>
        <div style={{padding:"0 16px"}}>
          <div onClick={()=>{setCfg(c=>({...c,track:"all"}));setScreen("session");}}
            style={{background:`linear-gradient(135deg,${ac}20,${ac}08)`,border:`1px solid ${ac}30`,borderRadius:14,padding:"14px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:14,marginBottom:10,animation:"su 0.25s ease"}}>
            <div style={{fontSize:26}}>üåü</div>
            <div style={{flex:1}}>
              <div style={{fontSize:16,fontWeight:600}}>Mix It Up</div>
              <div style={{fontSize:11,color:"rgba(255,255,255,0.25)"}}>All categories shuffled</div>
            </div>
          </div>
          {Object.entries(WORD_DB).map(([key,tr],i)=>{
            const n=tr.words.length;
            const m=tr.words.filter((_,j)=>(u.p[`${key}_${j}`]?.lv||0)>=7).length;
            const p=n>0?Math.round((m/n)*100):0;
            return(
              <div key={key} onClick={()=>{setCfg(c=>({...c,track:key}));setScreen("session");}}
                style={{background:`${tr.color}0D`,border:`1px solid ${tr.color}20`,borderRadius:14,padding:"13px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:14,marginBottom:7,animation:`su ${0.25+i*0.04}s ease`}}>
                <div style={{fontSize:24}}>{tr.icon}</div>
                <div style={{flex:1}}>
                  <div style={{fontSize:14,fontWeight:600}}>{tr.name}</div>
                  <div style={{marginTop:4,height:4,borderRadius:2,background:"rgba(255,255,255,0.06)",overflow:"hidden"}}>
                    <div style={{height:"100%",width:`${p}%`,background:tr.color,borderRadius:2,transition:"width 0.5s"}}/>
                  </div>
                </div>
                <div style={{fontSize:13,fontWeight:700,color:tr.color}}>{p>0?`${p}%`:""}</div>
              </div>
            );
          })}
        </div>
      </div>
    );
  }

  // STATS
  if(screen==="stats"){
    const u=ud,ac=user==="asher"?"#FF6B35":"#AA00FF";
    const aw=allWords(),total=aw.length;
    const mst=Object.values(u.p).filter(w=>w.lv>=7).length;
    const lrn=Object.values(u.p).filter(w=>w.lv>0&&w.lv<7).length;
    const seen=Object.keys(u.p).length;
    const pct=total>0?Math.round((mst/total)*100):0;
    const t=todayStr(),td=u.cal.d[t];
    const now=new Date(),yr=now.getFullYear(),mo=now.getMonth();
    const dim=new Date(yr,mo+1,0).getDate(),fd=new Date(yr,mo,1).getDay();
    const moN=now.toLocaleDateString("en-US",{month:"long"});
    const grp={};aw.forEach(w=>{const lv=u.p[w.id]?.lv||0;const m=mast(lv);if(!grp[m.l])grp[m.l]=[];grp[m.l].push({...w,level:lv});});
    return(
      <div style={{...PG,padding:"0 0 60px"}}>
        <div onClick={()=>setScreen("cats")} style={{padding:"14px 16px 0",fontSize:13,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>‚Üê Back</div>
        <div style={{padding:"8px 16px 12px",fontSize:20,fontWeight:700}}>üìä {user==="asher"?"Asher":"Rivka"}'s Stats</div>
        <div style={{display:"flex",gap:8,padding:"0 16px",marginBottom:10}}>
          <div style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",textAlign:"center",border:"1px solid rgba(255,255,255,0.05)"}}>
            <div style={{fontSize:22,fontWeight:700,color:ac}}>Lv {u.lv}</div>
            <div style={{fontSize:10,color:"rgba(255,255,255,0.25)"}}>{u.xp||0} XP</div>
          </div>
          <div style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",textAlign:"center",border:"1px solid rgba(255,255,255,0.05)"}}>
            <div style={{fontSize:22,fontWeight:700,color:"#FFD700"}}>{u.cal.s>=7?"üî•":"‚ú®"} {u.cal.s}</div>
            <div style={{fontSize:10,color:"rgba(255,255,255,0.25)"}}>best {u.cal.b}</div>
          </div>
          <div style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",textAlign:"center",border:"1px solid rgba(255,255,255,0.05)"}}>
            <div style={{fontSize:22,fontWeight:700,color:"#00E676"}}>{pct}%</div>
            <div style={{fontSize:10,color:"rgba(255,255,255,0.25)"}}>mastered</div>
          </div>
        </div>
        {td&&<div style={{display:"flex",gap:8,padding:"0 16px",marginBottom:10}}>
          {[{v:td.r,l:"Correct",c:"#00E676"},{v:td.r+td.w,l:"Practiced",c:"#2979FF"},{v:td.r+td.w>0?Math.round((td.r/(td.r+td.w))*100)+"%":"‚Äî",l:"Accuracy",c:"#FFD700"}].map((s,i)=>(
            <div key={i} style={{flex:1,background:"rgba(255,255,255,0.04)",borderRadius:10,padding:"8px 4px",textAlign:"center",border:"1px solid rgba(255,255,255,0.04)"}}>
              <div style={{fontSize:18,fontWeight:700,color:s.c}}>{s.v}</div>
              <div style={{fontSize:9,color:"rgba(255,255,255,0.25)"}}>{s.l} today</div>
            </div>
          ))}
        </div>}
        <div style={{margin:"0 16px 10px",background:"rgba(255,255,255,0.04)",borderRadius:12,padding:"10px",border:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{textAlign:"center",fontSize:11,fontWeight:600,color:"rgba(255,255,255,0.3)",marginBottom:6}}>{moN} {yr}</div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,textAlign:"center"}}>
            {["S","M","T","W","T","F","S"].map((d,i)=><div key={i} style={{fontSize:8,color:"rgba(255,255,255,0.2)",padding:"2px 0",fontWeight:700}}>{d}</div>)}
            {Array.from({length:fd},(_,i)=><div key={`e${i}`}/>)}
            {Array.from({length:dim},(_,i)=>{
              const day=i+1,ds=`${yr}-${String(mo+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
              const di=u.cal.d[ds],isT=ds===t;
              let bg="rgba(255,255,255,0.03)",brd="1px solid transparent";
              if(di&&di.r>=5){bg="rgba(0,230,118,0.25)";brd="1px solid rgba(0,230,118,0.4)";}
              else if(di&&di.r>0){bg="rgba(255,152,0,0.2)";}
              if(isT)brd=`2px solid ${ac}`;
              return<div key={day} style={{aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5,background:bg,border:brd,fontSize:10,fontWeight:isT?700:400,color:isT?ac:"rgba(255,255,255,0.3)"}}>{day}</div>;
            })}
          </div>
        </div>
        <div style={{padding:"0 16px"}}>
          {["MASTERED","Almost Pro","Getting It","Learning","New"].map(label=>{
            const items=grp[label]||[];if(!items.length)return null;const m=mast(items[0].level);
            return(<div key={label} style={{marginBottom:12}}>
              <div style={{fontSize:12,fontWeight:600,color:m.c,marginBottom:5}}>{m.e} {label} ({items.length})</div>
              <div style={{display:"flex",flexWrap:"wrap",gap:4}}>{items.map(w=><div key={w.id} style={{background:`${m.c}15`,border:`1px solid ${m.c}20`,borderRadius:7,padding:"3px 10px",fontSize:12}}>{w.word}</div>)}</div>
            </div>);
          })}
        </div>
      </div>
    );
  }

  // SESSION
  if(screen==="session")return <Sesh cfg={cfg} user={user} progress={ud.p} onAnswer={record} onExit={()=>setScreen("cats")}/>;
  return null;
}

function Sesh({cfg,user,progress,onAnswer,onExit}){
  const[words,setWords]=useState([]);
  const[idx,setIdx]=useState(0);
  const[input,setInput]=useState("");
  const[fb,setFb]=useState(null);
  const[reveal,setReveal]=useState(false);
  const[stats,setStats]=useState({r:0,w:0});
  const[done,setDone]=useState(false);
  const[burst,setBurst]=useState(false);
  const[msg,setMsg]=useState("");
  const[timer,setTimer]=useState(cfg.mode==="speed"?45:null);
  const[scram,setScram]=useState([]);
  const[picked,setPicked]=useState([]);
  const[gaps,setGaps]=useState(null);
  const[gapIn,setGapIn]=useState("");
  const ac=user==="asher"?"#FF6B35":"#AA00FF";

  useEffect(()=>{
    const all=allWords();
    let pool=cfg.track==="all"?all:all.filter(w=>w.track===cfg.track);
    pool.sort((a,b)=>{const la=progress[a.id]?.lv||0,lb=progress[b.id]?.lv||0;if(la===0&&lb!==0)return-1;if(lb===0&&la!==0)return 1;return la-lb;});
    setWords(shuffle(pool.slice(0,Math.min(cfg.mode==="speed"?15:5,pool.length))));
  },[cfg.track,cfg.mode]);

  useEffect(()=>{if(cfg.mode==="speed"&&timer>0&&!done){const t=setTimeout(()=>setTimer(s=>s-1),1000);return()=>clearTimeout(t);}if(cfg.mode==="speed"&&timer===0)setDone(true);},[timer,cfg.mode,done]);
  useEffect(()=>{if(cfg.mode==="type"&&words[idx]){const lv=progress[words[idx].id]?.lv||0;if(lv<=1){setReveal(true);setTimeout(()=>setReveal(false),1800);}}},[idx,words,cfg.mode]);
  useEffect(()=>{if(cfg.mode==="unscramble"&&words[idx]){let s=shuffle(words[idx].word.split(""));let t=0;while(s.join("").toLowerCase()===words[idx].word.toLowerCase()&&words[idx].word.length>2&&t<10){s=shuffle(words[idx].word.split(""));t++;}setScram(s);setPicked([]);}},[idx,words,cfg.mode]);
  useEffect(()=>{if(cfg.mode==="fill"&&words[idx]){const w=words[idx].word,lv=progress[words[idx].id]?.lv||0;const rn=Math.min(Math.max(1,Math.floor(w.length*(0.25+lv*0.05))),w.length-2);const ix=new Set();while(ix.size<rn){ix.add(1+Math.floor(Math.random()*(w.length-1)));}setGaps({ch:w.split("").map((c,i)=>ix.has(i)?null:c)});setGapIn("");}},[idx,words,cfg.mode]);

  const cw=words[idx];if(!cw&&!done)return null;
  const wLv=cw?(progress[cw.id]?.lv||0):0;

  const advance=()=>{setFb(null);setInput("");setGapIn("");setReveal(false);if(idx+1>=words.length)setDone(true);else setIdx(i=>i+1);};
  const doOk=()=>{onAnswer(cw.id,true);setStats(s=>({...s,r:s.r+1}));setFb("ok");setMsg(rand(FIRE));setBurst(true);speak("Yes!");setTimeout(()=>{setBurst(false);advance();},1100);};
  const doNo=()=>{onAnswer(cw.id,false);setStats(s=>({...s,w:s.w+1}));setFb("no");setMsg(rand(MISS));speak("It's spelled: "+cw.word.split("").join(", "));setTimeout(advance,2200);};
  const doCl=()=>{onAnswer(cw.id,false);setStats(s=>({...s,w:s.w+1}));setFb("cl");setMsg('So close! It\'s "'+cw.word+'"');speak("Almost! "+cw.word);setTimeout(advance,2000);};
  const sub=()=>{if(!input.trim())return;const r=chk(input,cw.word);if(r==="exact")doOk();else if(r==="close")doCl();else doNo();};
  const subG=()=>{if(!gapIn.trim())return;const r=chk(gapIn,cw.word);if(r==="exact")doOk();else if(r==="close")doCl();else doNo();};
  const tapS=(l,i)=>{const ns=[...scram];ns.splice(i,1);setScram(ns);const np=[...picked,l];setPicked(np);if(np.length===cw.word.length){if(np.join("").toLowerCase()===cw.word.toLowerCase())setTimeout(doOk,250);else setTimeout(()=>{doNo();setPicked([]);setScram(shuffle(cw.word.split("")));},250);}};
  const untap=(l,i)=>{const np=[...picked];np.splice(i,1);setPicked(np);setScram([...scram,l]);};

  if(done){
    const tot=stats.r+stats.w,pct=tot>0?Math.round((stats.r/tot)*100):0;
    const em=pct>=90?"üëë":pct>=70?"üèÜ":pct>=50?"‚≠ê":"üí™";
    const ln=pct>=90?"ABSOLUTE LEGEND!":pct>=70?"Great session!":pct>=50?"Solid work!":"Keep going ‚Äî you got this!";
    return(
      <div style={{...PG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:24}}>
        <div style={{fontSize:68,marginBottom:10,animation:"bn 0.8s ease"}}>{em}</div>
        <div style={{fontSize:24,fontWeight:700,marginBottom:4}}>{ln}</div>
        <div style={{fontSize:14,color:"rgba(255,255,255,0.4)",marginBottom:20}}>{stats.r} correct ¬∑ {stats.w} missed ¬∑ {pct}%</div>
        <div style={{display:"flex",flexWrap:"wrap",gap:6,justifyContent:"center",marginBottom:28}}>
          {words.map(w=><div key={w.id} style={{background:"rgba(255,255,255,0.05)",borderRadius:8,padding:"5px 12px",fontSize:13}}>{w.word}</div>)}
        </div>
        <div onClick={onExit} style={{background:"linear-gradient(135deg,"+ac+","+ac+"CC)",borderRadius:14,padding:"14px 44px",cursor:"pointer",fontSize:17,fontWeight:700,boxShadow:"0 4px 20px "+ac+"40"}}>Done</div>
        <div onClick={()=>{setIdx(0);setStats({r:0,w:0});setDone(false);setFb(null);setInput("");if(cfg.mode==="speed")setTimer(45);}}
          style={{marginTop:12,fontSize:14,color:ac,cursor:"pointer",fontWeight:600}}>üîÑ Again</div>
      </div>
    );
  }

  const progPct=words.length>0?((idx)/words.length)*100:0;
  const fbC=fb==="ok"?"#00E676":fb==="cl"?"#FFD700":"#FF5252";

  return(
    <div style={{...PG,display:"flex",flexDirection:"column"}}>
      {burst&&<Bst/>}
      <div style={{display:"flex",alignItems:"center",padding:"14px 16px 8px",gap:10}}>
        <div onClick={onExit} style={{fontSize:14,color:"rgba(255,255,255,0.3)",cursor:"pointer"}}>‚úï</div>
        <div style={{flex:1,height:6,borderRadius:3,background:"rgba(255,255,255,0.07)",overflow:"hidden"}}>
          <div style={{height:"100%",width:progPct+"%",background:"linear-gradient(90deg,"+ac+",#FFD700)",borderRadius:3,transition:"width 0.4s"}}/>
        </div>
        <div style={{fontSize:13,color:"rgba(255,255,255,0.3)",minWidth:36,textAlign:"right"}}>{idx+1}/{words.length}</div>
        {cfg.mode==="speed"&&<div style={{fontSize:16,fontWeight:700,color:timer<=10?"#FF5252":"#FFD700",animation:timer<=10?"pu 0.5s infinite":"none"}}>{timer}s</div>}
      </div>
      <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0 20px"}}>
        <div style={{fontSize:10,color:"rgba(255,255,255,0.2)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:3}}>{WORD_DB[cw.track]?.icon} {WORD_DB[cw.track]?.name}</div>
        <div style={{fontSize:16,color:"rgba(255,255,255,0.5)",textAlign:"center",marginBottom:8,lineHeight:1.5,fontStyle:"italic",maxWidth:300}}>"{cw.sentence}"</div>
        <div onClick={()=>speak(cw.word,0.7)} style={{fontSize:13,color:ac,cursor:"pointer",marginBottom:10}}>üîä Hear it</div>
        {(cfg.mode==="type"||cfg.mode==="speed")&&<React.Fragment>
          <div style={{fontSize:28,fontWeight:700,letterSpacing:3,marginBottom:4,color:reveal?"#FFD700":"rgba(255,255,255,0.1)",transition:"color 0.3s",minHeight:38}}>{reveal?cw.word:scaf(cw.word,wLv)}</div>
          <div style={{fontSize:12,color:"rgba(255,255,255,0.2)",marginBottom:14}}>üí° {cw.hint}</div>
        </React.Fragment>}
        {cfg.mode==="unscramble"&&<React.Fragment>
          <div style={{fontSize:12,color:"rgba(255,255,255,0.2)",marginBottom:10}}>üí° {cw.hint}</div>
          <div style={{display:"flex",gap:5,marginBottom:12,minHeight:44,flexWrap:"wrap",justifyContent:"center"}}>
            {cw.word.split("").map((_,i)=>(
              <div key={i} onClick={()=>picked[i]&&untap(picked[i],i)}
                style={{width:35,height:42,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,cursor:picked[i]?"pointer":"default",background:picked[i]?ac+"25":"rgba(255,255,255,0.03)",border:picked[i]?"2px solid "+ac+"60":"2px dashed rgba(255,255,255,0.08)",color:picked[i]?"#fff":"transparent"}}>{picked[i]||""}</div>
            ))}
          </div>
          <div style={{display:"flex",gap:7,flexWrap:"wrap",justifyContent:"center"}}>
            {scram.map((l,i)=>(
              <div key={i} onClick={()=>tapS(l,i)}
                style={{width:42,height:48,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,cursor:"pointer",background:"rgba(255,255,255,0.07)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"}}>{l}</div>
            ))}
          </div>
        </React.Fragment>}
        {cfg.mode==="fill"&&gaps&&<React.Fragment>
          <div style={{fontSize:12,color:"rgba(255,255,255,0.2)",marginBottom:12}}>üí° {cw.hint}</div>
          <div style={{display:"flex",gap:4,marginBottom:16,justifyContent:"center",flexWrap:"wrap"}}>
            {gaps.ch.map((c,i)=>(
              <div key={i} style={{width:31,height:40,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,background:c?"rgba(255,255,255,0.05)":ac+"15",border:c?"1px solid rgba(255,255,255,0.06)":"2px dashed "+ac+"50",color:c?"rgba(255,255,255,0.6)":ac}}>{c||"?"}</div>
            ))}
          </div>
          <div style={{fontSize:11,color:"rgba(255,255,255,0.2)",marginBottom:6}}>Type the full word:</div>
        </React.Fragment>}
        {fb&&<div style={{fontSize:16,fontWeight:700,marginTop:8,color:fbC,animation:"su 0.3s ease",textAlign:"center"}}>
          {fb==="no"&&<div style={{fontSize:13,marginBottom:4}}>It's: <span style={{color:"#FFD700",letterSpacing:1}}>{cw.word}</span></div>}
          {msg}
        </div>}
      </div>
      {(cfg.mode==="type"||cfg.mode==="speed")&&!fb&&(
        <div style={{padding:"12px 16px 20px",background:"rgba(0,0,0,0.2)",borderTop:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{display:"flex",gap:10}}>
            <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")sub();}}
              placeholder="Type the word..." autoFocus autoCapitalize="none" autoCorrect="off" spellCheck="false"
              style={{flex:1,padding:"14px 16px",borderRadius:12,border:"2px solid "+ac+"40",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:18,fontFamily:FNT,outline:"none",letterSpacing:1}}/>
            <div onClick={sub} style={{padding:"14px 20px",borderRadius:12,background:ac,cursor:"pointer",fontSize:16,fontWeight:700,display:"flex",alignItems:"center"}}>Go ‚ûú</div>
          </div>
        </div>
      )}
      {cfg.mode==="fill"&&!fb&&(
        <div style={{padding:"12px 16px 20px",background:"rgba(0,0,0,0.2)",borderTop:"1px solid rgba(255,255,255,0.04)"}}>
          <div style={{display:"flex",gap:10}}>
            <input value={gapIn} onChange={e=>setGapIn(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")subG();}}
              placeholder="Type the full word..." autoFocus autoCapitalize="none" autoCorrect="off" spellCheck="false"
              style={{flex:1,padding:"14px 16px",borderRadius:12,border:"2px solid "+ac+"40",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:18,fontFamily:FNT,outline:"none",letterSpacing:1}}/>
            <div onClick={subG} style={{padding:"14px 20px",borderRadius:12,background:ac,cursor:"pointer",fontSize:16,fontWeight:700,display:"flex",alignItems:"center"}}>Go ‚ûú</div>
          </div>
        </div>
      )}
    </div>
  );
}

function Bst(){
  const ps=Array.from({length:14},(_,i)=>({x:(Math.random()-0.5)*220,y:(Math.random()-0.5)*220-40,s:Math.random()*10+5,c:["#FFD700","#FF6B35","#00E676","#2979FF","#E91E63","#AA00FF"][i%6],d:Math.random()*0.3}));
  return(<div style={{position:"fixed",top:"35%",left:"50%",pointerEvents:"none",zIndex:999}}>
    {ps.map((p,i)=><div key={i} style={{position:"absolute",width:p.s,height:p.s,background:p.c,borderRadius:p.s>9?"50%":"2px","--tx":p.x+"px","--ty":p.y+"px",animation:"cb 0.9s ease-out "+p.d+"s forwards",opacity:0}}/>)}
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
